.panel.panel-default#linked-account-index
  .panel-heading
    %h3.panel-title Your Linked Accounts
  .panel-body
    -if current_user.linked_accounts.any?
      -current_user.linked_accounts.each do |linked_account|
        %li.list-group-item{ data: { linked_account_id: linked_account.present? ? linked_account.id : nil } }
          .row
            .col-xs-6
              .col-xs-3
                .img-thumbnail
                  -if linked_account.financial_institution.logo
                    =image_tag(linked_account.financial_institution.logo, height: 32)
              .col-xs-9
                %span.lead=linked_account.financial_institution.name
            .col-xs-6.text-right
              -if linked_account.present? && linked_account.status != "started"

                -if linked_account.status == "linked"

                  -if linked_account.error_message.blank?
                    =link_to linked_account, class: "btn btn-primary-o btn-responsive linked-account-button", data: {user_id: current_user.id} do
                      view account

                  -else
                    .tooltip-container{ data: {toggle: "tooltip", placement: "left", title: "Message from your account: #{linked_account.error_message}" }}

                      =link_to new_linked_account_path(financial_institution_id: institution.id), remote: true, class: "btn btn-primary-o btn-responsive linked-account-button" do
                        Needs Attention

                -elsif linked_account.status == "unlinked"
                  =link_to linked_account, class: "btn btn-warning btn-responsive linked-account-button" do
                    unlinked
                  =link_to "Link", new_linked_account_path(financial_institution_id: institution.id), remote: true, class: "btn btn-primary btn-responsive linked-account-button"


                -elsif linked_account.status == "mfa"
                  =link_to "Link", new_linked_account_path(financial_institution_id: institution.id), remote: true, class: "btn btn-primary btn-responsive"

                -else
                  .tooltip-container{ data: {toggle: "tooltip", placement: "left", title: "Trym is #{linked_account.status} data from #{linked_account.account_name} to indentify potentially recurring charges.  This shouldn't take long." }}
                    %a.btn.btn-primary-o.btn-responsive.linked-account-button{disabled: "disabled"}
                      %i.fa.fa-circle-o-notch.fa-spin
                      =linked_account.status

    -else
      .well
        %p.text-center You don't yet have any accounts linked to Trym!<br><br>
        .text-center
          %button.btn.btn-primary.btn-lg{"data-target" => "#link-account-modal", "data-toggle" => "modal", :type => "button"}
            %i.glyphicon.glyphicon-plus
            Add an Account

-if current_user.linked_accounts.any?
  %button.btn.btn-primary.btn-lg{"data-target" => "#link-account-modal", "data-toggle" => "modal", :type => "button"}
    %i.glyphicon.glyphicon-plus
    Add an Account
  %button.btn.btn-default.btn-lg
    %i.glyphicon.glyphicon-th-list
    =link_to "Transactions", search_charges_path

#link-account-modal.modal.fade{:role => "dialog", :tabindex => "-1"}
  .modal-dialog{:role => "document"}
    .modal-content
      .modal-header
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
          %span{"aria-hidden" => "true"} &#215;
        %h4.modal-title Link an Account with Trym
      .modal-body
        .row
          .col-md-10.col-md-offset-1
            -FinancialInstitution.connect_enabled.in_groups_of(4) do |institution_group|
              .row
              -institution_group.each do |institution|
                -if institution
                  .img-thumbnail
                    =link_to image_tag(institution.logo, width: 96), new_linked_account_path(financial_institution_id: institution.id), remote: true

      .modal-footer
        %button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Close
