(function ($) {
    "use strict";

    Drupal.behaviors.request_callback_form = {
        attach: function (context, settings) {
            var $form = $('#callback-form');
            if ($form.length) {
                $form.parsley().destroy();
                $form.parsley();

                //Stop the submit of the form if it is not valid
                $('input[type=submit]', '#callback-form').click(function (e) {
                    e.preventDefault(); //prevent default form submit
                    var valid = $form.parsley().validate();
                    if (valid) {
                        $('#request-callback-modal .modal-throbber').removeClass('hidden');
                        $(this).trigger('submit_form');
                    }
                });

                //Regenerate the modal (form) on close AND when it is displaying the thank you page
                $('#request-callback-modal').on('hide.bs.modal', function (e) {
                    //var mymodal = $(this);
                    if ($('#request-callback-modal .thanks').length) {
                        //e.preventDefault();
                        var country = (Drupal.settings.tesla.locale != 'en_US') ? "/" + Drupal.settings.tesla.locale : '';
                        $('.modal-body', '#request-callback-modal').load(country + "/tesla_request_callback/regenerate", function () {
                            Drupal.attachBehaviors();
                            // wait until the form have been created
                            //mymodal.modal('hide');
                        });
                    }
                });
            }
        }
    };

})(jQuery);

/*
 * Helper function that will select a quote for the modal, this require that the link to the modal have a new attribute
 * onclick="multiple_choice( $('#name-of-the-quote-to-select')
 *
 * Possible values for the quotes are:
 *
 * edit-request-leasing-request-callback == Leasing
 * edit-request-financing-request-callback == Financing
 * edit-request-trade-in-request-callback == Trade In
 * edit-request-callback-request-callback == Request Callback (US only)
 * */
var multiple_choice = function (the_checkbox) {
    $('.sending-options').find(':checkbox').attr('checked', false);
    the_checkbox.attr('checked', true);
};